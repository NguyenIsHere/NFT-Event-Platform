_format_version: "3.0"
_comment: "Kong declarative configuration"

consumers:
  - username: generic-app-user
    jwt_secrets:
      - key: "my-application"
        algorithm: HS256
        secret: "{env://KONG_JWT_SHARED_SECRET_VAR}"

# --- Services ---
services:
  - name: auth-grpc-service
    host: auth-service.service.consul
    port: 50052
    protocol: grpc
    plugins:
      - name: grpc-gateway
        config:
          proto: /etc/kong/protos/auth.proto

  - name: user-grpc-service
    host: user-service.service.consul
    port: 50053
    protocol: grpc
    plugins:
      - name: grpc-gateway
        config:
          proto: /etc/kong/protos/user.proto
  
  - name: ipfs-grpc-service
    host: ipfs-service.service.consul
    port: 50058
    protocol: grpc
    plugins:
      - name: grpc-gateway
        config:
          proto: /etc/kong/protos/ipfs.proto

  - name: event-grpc-service
    host: event-service.service.consul
    port: 50054
    protocol: grpc
    plugins:
      - name: grpc-gateway
        config:
          proto: /etc/kong/protos/event.proto

  - name: ticket-grpc-service
    host: ticket-service.service.consul
    port: 50055
    protocol: grpc
    plugins:
      - name: grpc-gateway
        config:
          proto: /etc/kong/protos/ticket.proto

# --- Routes ---
# Kong routes với path structure mới (chỉ phần ticket-related)

routes:
  # === TicketType Service Routes - PATH MỚI ===
  - name: tickettype-create-route-v1
    service: ticket-grpc-service
    paths: ["/v1/ticket-types/create"]
    methods: [POST]
    strip_path: false

  - name: tickettype-update-route-v1
    service: ticket-grpc-service
    paths: ["/v1/ticket-types/{ticket_type_id}"]
    methods: [PUT]
    strip_path: false

  - name: tickettype-get-by-id-route-v1
    service: ticket-grpc-service
    paths: ["/v1/ticket-types/{ticket_type_id}"]
    methods: [GET]
    strip_path: false

  - name: tickettype-list-by-event-route-v1
    service: ticket-grpc-service
    paths: ["/v1/ticket-types/by-event/{event_id}"]
    methods: [GET]
    strip_path: false

  - name: tickettype-list-by-session-route-v1
    service: ticket-grpc-service
    paths: ["/v1/ticket-types/by-session/{event_id}/{session_id}"]
    methods: [GET]
    strip_path: false
  
  # === Ticket Service Routes - PATH MỚI ===
  - name: ticket-initiate-purchase-route-v1
    service: ticket-grpc-service
    paths: ["/v1/tickets/initiate-purchase"]
    methods: [POST]
    strip_path: false

  - name: ticket-confirm-payment-mint-route-v1
    service: ticket-grpc-service
    paths: ["/v1/tickets/confirm-payment-mint"]
    methods: [POST]
    strip_path: false

  # - name: ticket-get-by-id-route-v1
  #   service: ticket-grpc-service
  #   paths: ["/v1/tickets/{ticket_id}"]
  #   methods: [GET]
  #   strip_path: false

  # - name: ticket-list-by-event-route-v1
  #   service: ticket-grpc-service
  #   paths: ["/v1/tickets/by-event/{event_id}"]
  #   methods: [GET]
  #   strip_path: false

  # - name: ticket-list-by-owner-route-v1
  #   service: ticket-grpc-service
  #   paths: ["/v1/tickets/by-owner/{owner_address}"]
  #   methods: [GET]
  #   strip_path: false

  # === Event Service Routes (GIỮ NGUYÊN) ===
  - name: event-create-route-v1
    service: event-grpc-service
    paths: ["/v1/events"]
    methods: [POST]
    strip_path: false

  - name: event-get-by-id-route-v1
    service: event-grpc-service
    paths: ["/v1/events/{event_id}"]
    methods: [GET]
    strip_path: false

  - name: event-list-route-v1
    service: event-grpc-service
    paths: ["/v1/events"]
    methods: [GET]
    strip_path: false

  - name: event-publish-route-v1
    service: event-grpc-service
    paths: ["/v1/events/{event_id}/publish"]
    methods: [POST]
    strip_path: false